!define REMOTE_DEBUG_COMMAND {java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=1044 -cp %p %m}


!3 TS41-K-004 – Överför stort meddelande

!4 Set Up

!- Create a file with more than 16 MB size in order to trigger that Axel's SharedDeferredStream makes an overflow to disk. -!

|Script|Shs Cmdline Driver|
|$file_name= |create file with size in bytes |${= 17*1024*1024 =} |

!4 Överför till Axel-dev

|Shs Async Send Message                                                             |
|from address |to address |product id                           |input file |tx id? |
|0000000000   |0000000000 |00000000-0000-0000-0000-000000000000 |$file_name |$txId= |

|Check that message is available in |${localDeliveryServiceUrl}                            |
|tx id                              |to address |correlation id |fetch list? |item exists? |
|$txId                              |0000000000 |$txId          |FOUND       |true         |

|Shs Async Fetch Message                                  |
|To Address |Tx Id |input file |received file is correct? |
|0000000000 |$txId |$file_name |true                      |

|TODO: Cleanup big file in Mongo, remote file system etc. |

!4 Överför till Axel-ref

|Shs Async Send Message                                                             |
|from address |to address |product id                           |input file |tx id? |
|0000000000   |1111111111 |00000000-0000-0000-0000-000000000000 |$file_name |$txId= |

|Check that message is available in |${remoteDeliveryServiceUrl}                            |
|tx id                              |to address |correlation id |fetch list? |item exists? |
|$txId                              |1111111111 |$txId          |FOUND       |true         |

|Shs Async Fetch Message                                  |
|To Address |Tx Id |input file |received file is correct? |
|1111111111 |$txId |$file_name |true                      |

|TODO: Cleanup big file in Mongo, remote file system etc. |

!4 Tear Down

|Script|Shs Cmdline Driver|
|ensure      |remove file                    |$file_name       |
